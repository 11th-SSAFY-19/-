# ✅ 규모 추정
시스템 설계 면접을 볼 때, 때로는 시스템 용량이나 성능 요구사항을 개략적으로 추정해보라는 요구받게 된다.

개략적인 규모 추정은 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것이다. 

개략적 규모 추정을 효과적으로 해 내려면 다음을 알아야 한다.

## 1. 2의 제곱수
데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 우선 알아야 한다.<br>
최소 단위는 1바이트이고, ASCII 문자 하나가 차지하는 메모리 크기가 1바이트이다.

|2의 n제곱|근사치|이름|축약형|
|---|---|---|---|
|10|1천 (thousand)|1킬로바이트 (kilobyte)|1KB|
|20|1백만 (million)|1메가바이트 (megabyte)|1MB|
|30|10억 (billion)|1기가바이트 (kilobyte)|1GB|
|40|1조 (trillion)|1테라바이트 (kilobyte)|1TB|
|50|1000조 (quadrillion)|1페타바이트 (kilobyte)|1PB|

## 2. 모든 프로그래머가 알아야 하는 응답지연 값
구글의 제프 딘이 2010년에 통상적은 컴퓨터에서 구현된 연산들의 응답지연 값을 공개한 바가 있다.

2010년 통상적인 컴퓨터의 연산들의 응답지연 값으로 현재 컴퓨터의 속도로 보기에는 약간 무리가 있지만, 해당 수치들은 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있도록 해준다.

- 뮤텍스 락/언락 : 100ns
- 주 메모리 참조 : 100ns
- Zippy로 1KB 압축 : 10us
- 1Gbps 네트워크로 2KB 전송 : 20,000ns = 10us
- 메모리에서 1MB 순차적으로 read : 500,000ns = 250us
- 디스크 탐색 : 10,000,000ns = 10ms
- 네트워크에서 1MB 순차적으로 read : 10ms
- 디스크에서 1MB 순차적으로 read : 30ms
- 한 패킷의 캘리포니아로부터 네델란드까지의 왕복 지연시간 : 150ms

<br>

이러한 수치가 2020년에 시각화되었는데, 해당 수치들을 분석하면 아래 결론이 나온다.
- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라. (gzip)
- 데이터 센터는 보통 여러 지역에 분산되어 있고 센터들 간에 데이터를 주고받는데는 시간이 걸린다.

## 3. 가용성에 관계된 수치들

> 고가용성 : 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력

고가용성을 표현하는 값은 퍼센트로 표현하는데, 100%는 시스템이 단 한번도 중단된 적이 없었음을 의미한다. 대부분의 서비스는 99%에서 100% 사이의 값을 갖는다.

가용시간은 관습적으로 숫자 9를 사용해 표시한다. 9가 많으면 많을수록 좋다고 보면 된다.
- 99% : 연간 장애시간 - 3.65일
- 99.9% : 연간 장애시간 - 8.77시간
- 99.99% : 연간 장애시간 - 52.60분
- 99.999% : 연간 장애시간 - 5.26분

### 예제 - 트위터 QPS와 저장소 요구량 추정

가정
- 월간 능동 사용자는 3억 명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년간 보관된다.

<br>

QPS(Query Per Second) 추정치
- 일간 능동 사용자(Daily Active User, DAU) = 3억 * 50% = 1.5억
- QPS = 1.5억 * 2트윗 / 24시간 / 3600초 = 약 3500
- 최대 QPS = 2 * QPS = 약 7000

<br>

미디어 저장을 위한 저장소 요구량
- 평균 트위 크기
  - `tweet_id`에 64바이트
  - 텍스트에 140바이트
  - 미디어에 1MB
- 미디어 저장소 요구량 : 1.5억 * 2트윗 * 10% * 1MB = 30TB / 일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB * 365 * 5 = 약 55PB

> 🌼 팁 🌼<br>
개략적인 규모 추정과 관련된 면접에서 가장 중요한 것은 문제를 풀어나가는 절차다. 즉, 올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다.
> - 근사치를 활용한 계산 (ex. `99987 / 9.1` 보다는 `100,000 / 10`로 수치 간소화)
> - 나중에 볼 수 있도록 가정들을 적어 놓자.
> - 단위를 적는 습관을 가지자. (ex. `5`가 `5KB`인지 `5MB`인지)
> - 많이 출제되는 문제는 `QPS`, `최대 QPS`, `저장소 요구량`, `캐시 요구량`, `서버 수` 등을 추정하는 것이다. 면접에 임하기 전에 계산하는 연습을 미리 하자.



